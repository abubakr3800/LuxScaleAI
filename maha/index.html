<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Lighting Design Calculator</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">
    <h2 class="mb-4 text-center">Lighting Design Calculator</h2>
    
    <div class="card p-4 shadow-sm">
        <form id="calcForm">
            <h5>Project Information</h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Project Name</label>
                    <input type="text" class="form-control" name="Project Name" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Client Name</label>
                    <input type="text" class="form-control" name="Client Name" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Client Number</label>
                    <input type="text" class="form-control" name="Client Number" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Company Name</label>
                    <input type="text" class="form-control" name="Company Name" required>
                </div>
            </div>

            <hr>
            <h5>Room Details</h5>
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Place</label>
                    <select class="form-select" id="place" required>
                        <option value="Room">Room</option>
                        <option value="Office">Office</option>
                        <option value="Cafe">Cafe</option>
                        <option value="Factory production line">Factory production line</option>
                        <option value="Factory warehouse">Factory warehouse</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Side A (m)</label>
                    <input type="number" class="form-control" id="sideA" step="0.01" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Side B (m)</label>
                    <input type="number" class="form-control" id="sideB" step="0.01" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Side C (m)</label>
                    <input type="number" class="form-control" id="sideC" step="0.01" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Side D (m)</label>
                    <input type="number" class="form-control" id="sideD" step="0.01" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Height (m)</label>
                    <input type="number" class="form-control" id="height" step="0.01" required>
                </div>
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">Calculate</button>
                <button type="button" id="downloadPdf" class="btn btn-success">Download PDF</button>
            </div>
        </form>
    </div>

    <div class="card p-4 shadow-sm mt-4">
        <h5>Results</h5>
        <div class="table-responsive">
            <table class="table table-bordered" id="resultsTable">
                <thead>
                    <tr>
                        <th>Luminaire</th>
                        <th>Power (W)</th>
                        <th>Efficacy (lm/W)</th>
                        <th>Fixtures</th>
                        <th>Spacing X (m)</th>
                        <th>Spacing Y (m)</th>
                        <th>Average Lux</th>
                        <th>Uniformity</th>
                        <th>Total Power (W)</th>
                        <th>Beam Angle (Â°)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const apiBase = "https://mahamonir.pythonanywhere.com"; // Change to your server URL

document.getElementById("calcForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const projectInfo = {};
    document.querySelectorAll("#calcForm input[name]").forEach(input => {
        projectInfo[input.name] = input.value;
    });

    const payload = {
        place: document.getElementById("place").value,
        sides: [
            parseFloat(document.getElementById("sideA").value),
            parseFloat(document.getElementById("sideB").value),
            parseFloat(document.getElementById("sideC").value),
            parseFloat(document.getElementById("sideD").value)
        ],
        height: parseFloat(document.getElementById("height").value),
        project_info: projectInfo
    };

    const res = await fetch(`${apiBase}/calculate`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    });
    const data = await res.json();

    const tbody = document.querySelector("#resultsTable tbody");
    tbody.innerHTML = "";

    if (data.results) {
        data.results.forEach(row => {
            const tr = document.createElement("tr");
            Object.values(row).forEach(val => {
                const td = document.createElement("td");
                td.textContent = val;
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
    }
});

document.getElementById("downloadPdf").addEventListener("click", async () => {
    const projectInfo = {};
    document.querySelectorAll("#calcForm input[name]").forEach(input => {
        projectInfo[input.name] = input.value;
    });

    const payload = {
        place: document.getElementById("place").value,
        sides: [
            parseFloat(document.getElementById("sideA").value),
            parseFloat(document.getElementById("sideB").value),
            parseFloat(document.getElementById("sideC").value),
            parseFloat(document.getElementById("sideD").value)
        ],
        height: parseFloat(document.getElementById("height").value),
        project_info: projectInfo
    };

    const res = await fetch(`${apiBase}/pdf`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    });

    const blob = await res.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "report.pdf";
    document.body.appendChild(a);
    a.click();
    a.remove();
});
</script>

</body>
</html>
